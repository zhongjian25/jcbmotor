$define(["wgt_util","jquery.adFocus","jquery.easyZoom","jquery.dialogMgr","jquery.qrcode","jquery.fileDownload","wgt_readyload","md5","jquery.confirm","jquery.message","jquery.mediaQuery","bootstrap"],function($,$0,$1,$2,$3,$4,$5,r,$6,$7,$8,$9,$10){var glp=this._params,moqNum=0,stockNum,tipMoqNum,tipStockNum,ajxaQueryFun=function(t,e,i,a,s,n){var o={};o.request_url=i,o.url_param=a,o.requst_type=s,"true"==e.isMock&&(o.url_param.isMock="true");var d=encodeURIComponent(encodeURIComponent(JSON.stringify(o))),r=$.md5Sign(JSON.stringify(o));$.ajax({type:"POST",url:"/comp/portalRouter",data:{sign:r,param:d},success:function(t){n(t)},error:function(){}})},getFileData=function(t,e,i,a,s,n){$.ajax({type:s,url:i,data:a,success:function(t){n(t)},error:function(){}})};function isEmpty(t){return t==undefined||null==t||0==t.length}function getIframeParam(t,e,i,a){return{id:e.id,cls:e.styleId,scp:t,htmlType:"singleRow",dialogSrc:a||"",popupName:i.popupName,dialogWidth:i.popupWidth,dialogHeight:i.popupHeight,dialogEsStyle:e.es_PopupWindow,closeEsStyle:e.es_CloseBtn,shadeEsStyle:e.es_shade,popupAnimationEffect:i.animationEffect,popupAnimationTimeLong:i.animationTimeLong,popupState:i.popupState}}function linkSkipFun(t,e,i,a){"_popup"==i?a&&t.data(a).show({dialogSrc:e}):"_blank"==i?$.openNewWindow(e):$.openHref(e),$._UTL.stopEvent(event)}function getHDCutResult(isHD,isCut){var result="normal";return eval(isHD)&&(result="hd"),eval(isCut)&&(result="cut"),eval(isHD)&&eval(isCut)&&(result="both"),result}function productImageHandle(params){var compId="c_"+params.id+"-imgjs",images_HDCut=getHDCutResult(params.images_isHD,params.images_isCut),ThumbnailBox_HDCut=getHDCutResult(params.ThumbnailBox_isHD,params.ThumbnailBox_isCut),tag_HDCut=getHDCutResult(params.TagBox_isHD,params.TagBox_isCut),_imgJson=setNewVideoImgJson(params),nav_type="block";$.mediaQuery({callback768:function(){nav_type="s"}});var _opts={data:_imgJson,containerCls:"",comp_type:"productZoom",has_video:!0,comp_w_size:params.imageWidth,comp_h_size:params.imageHeight,box_img_style_0:"e_box",box_img_style_2:"p_images",e_img_style_0:"e_image",e_img_style_2:"p_image",e_a_img_style_0:"e_link",e_a_img_style_2:"p_linkB",e_a_txt_style_0:"e_link",e_a_txt_style_2:"p_linkA",box_nav_style_0:"e_box",box_nav_style_2:"p_ThumbnailBox",e_nav_img_style_0:"e_relationimg",e_nav_img_style_2:"p_ProRelationImg",e_nav_arrow_l_style_0:"e_switchbtn",e_nav_arrow_l_style_2:"p_SwitchBtnC",e_nav_arrow_r_style_0:"e_switchbtn",e_nav_arrow_r_style_2:"p_SwitchBtnD",box_tag_style_0:"e_box",box_tag_style_2:"p_TagBox",e_img_tag_style_0:"e_image",e_img_tag_style_2:"p_tag",img_tag_display:eval(params.TagBox),img_tag_display_type:tag_HDCut,img_scale_x:null,img_scale_y:null,img_w_size:params.imageWidth,img_h_size:params.imageHeight,img_display_type:images_HDCut,img_autoPlay:!0,img_autoPlayDuration:5,img_transition:"fade",img_speed:1e3,img_easing:"easeOutQuart",nav_display_status:eval(params.ThumbnailBox),nav_type:nav_type,nav_scale_x:parseInt(params.ThumbnailBox_defWidth)||4,nav_scale_y:parseInt(params.ThumbnailBox_defHeight)||3,nav_s_size_w:20,nav_s_size_h:20,nav_display_num:parseInt(params.ThumbnailBox_column)||6,nav_position:"center",nav_display_padding:10,nav_keyboardOnAlways:!0,nav_step:1,nav_hover:!0,txt_display_status:!1,nav_img_display_type:ThumbnailBox_HDCut};function cssSet(t){t.toggleClass("item_hide")}function navPosition(t){0<$("."+compId).find(".e_atlasbox-001").length?$("."+compId).children().children().eq(3).css("text-align",t):$("."+compId).children().children().eq(2).css("text-align",t)}$("."+compId).data("adFocus",null),$("."+compId).empty(),$("."+compId).adFocus(_opts),params.easy_Zoom&&$("."+compId+" a.zoom").each(function(){$(this).easyZoom({zoomId:"."+compId})}),$("."+compId).dblclick(function(t){return $(".panel").toggleClass("item_hide"),!1}),$("body").delegate(".btn-switch","click",function(t){var e,i=$(this).attr("data-elem");return $(this).toggleClass("on"),"j-title"===i&&(e=!!$(this).hasClass("on"),_opts.txt_title=e),"j-describe"===i&&(e=!!$(this).hasClass("on"),_opts.txt_describe=e),"j-pageNum"===i&&(e=!!$(this).hasClass("on"),_opts.img_display_pageNum=e),"j-galary-txt"===i&&(e=!!$(this).hasClass("on"),_opts.nav_galary_txt_display=e),elm="e_switchbtn"===i?(e=!!$(this).hasClass("on"),_opts.img_arrows=e,$("."+compId).find(".p_box-01").find("."+i)):$("."+compId).find("."+i),cssSet(elm),$("."+compId).adFocus(_opts,!0),!1}),$(".addon-btn").on("click",function(){var t,e=$(this),i=e.parent().find("select").val(),a=e.attr("data-elem");("j-animate"===a&&(_opts.img_transition=i),"j-display-galary"===a&&(_opts.nav_display_galary="true"==i),"j-displayNum"===a&&(_opts.nav_display_num=i),"j-imgSize"===a)&&(0<i.indexOf("X")&&(t=i.split("X"),_opts.img_w_size=t[0],_opts.img_h_size=t[1],_opts.img_scale_x="",_opts.img_scale_y=""),0<i.indexOf(":")&&(t=i.split(":"),_opts.img_scale_x=t[0],_opts.img_scale_y=t[1],_opts.img_w_size="",_opts.img_h_size=""));("j-padding"===a&&(_opts.nav_display_padding=i),"j-nav-galary-size"===a)&&(0<i.indexOf(":")&&(t=i.split(":"),_opts.nav_galary_scale_x=t[0],_opts.nav_galary_scale_y=t[1]));return $("."+compId).adFocus(_opts),!1}),$(".example").find(".btn").on("click",function(){var t=$(this),e=t.attr("data-elem");return t.addClass("blue").siblings().removeClass("blue"),_opts.nav_position=e,$("."+compId).adFocus(_opts,!0),navPosition(e),!1})}function setPosition(){r.setCompPostion(),r.lazyImg({defObj:"body"})}function setTab(t,e){var i=t.TabDecTab,a=t.TabSpecTab;i||(1!=i&&1==a?(e.find("#contentPage").removeClass("active"),e.find("#paramPage").addClass("active"),e.find("#paramDiv").removeClass("hide")):1!=i&&1!=a&&(e.find("#contentPage").removeClass("active"),e.find("#paramPage").removeClass("active"),e.find(".TabHead").eq(0).addClass("active"),e.find(".TabCont").eq(0).removeClass("hide")))}function getImgSrc(t){var i=new Array;return t&&0<t.length&&$(t).each(function(t,e){i[t]=$(e).attr("data-src").substring(17,39)}),i}function ShotVRBtn(t){t.find(".p_show360").unbind("click").bind("click",function(){t.find(".d_masker-wp").removeClass("hide")}),t.find(".d_Close").unbind("click").bind("click",function(){t.find(".d_masker-wp").addClass("hide")}),t.find("#turntable").putPhotoDiv(2)}var detaiJson=null;function PruductskuDetail(a,n){if(!a.find("#product-skuDetail")&&""==a.find("#product-skuDetail").val())return!1;var t=a.find("#product-skuDetail").val();if(0<a.find("#product-skuDetail").length&&""!=t&&(detaiJson=$.parseJSON(a.find("#product-skuDetail").val())),detaiJson&&detaiJson.specConfs)var e=detaiJson.specConfs;var o="",d="",r=!1;detaiJson&&detaiJson.specs&&($.each(detaiJson.specs,function(t,e){o+='<div style="margin-bottom:10px;">',r=!0;for(var i=0;i<e.productSpecValues.length;i++)for(var a=0;a<detaiJson.specConfs.length;a++)if(detaiJson.specConfs[a].specValueId==e.productSpecValues[i].id){d="";for(var s=0;s<detaiJson.skus[0].productSkuSpecs.length;s++)if(detaiJson.specConfs[a].specValueId==detaiJson.skus[0].productSkuSpecs[s].specValueId){d="active";break}r&&(r=!1,o=o+e.name+"ï¼š"),e.productSpecValues[i].imagePath?("/"==e.productSpecValues[i].imagePath.substr(0,1)&&(e.productSpecValues[i].imagePath=e.productSpecValues[i].imagePath.slice(1)),"true"==n.productsA?o+="<div data-specId="+e.productSpecValues[i].specId+' class="e_box e_ProductBox-001 p_Product product '+d+'" data-id='+e.productSpecValues[i].id+"><div data-specId="+e.productSpecValues[i].specId+' class="e_box e_box-000 p_images picture higher" style="padding-bottom: 100%; height: 0px;"><div class="e_image e_image-000 p_image visible"><img src="'+(detaiJson.specConfs[a].productSpecImgList[0]?detaiJson.specConfs[a].productSpecImgList[0].imagePath:e.productSpecValues[i].imagePath)+'" title="'+detaiJson.specConfs[a].alias+'" alt="'+detaiJson.specConfs[a].alias+'" putphotocls="higher"></div></div></div>':o+="<div data-specId="+e.productSpecValues[i].specId+' class="e_box e_ProductBox-001 p_Product product '+d+'" data-id='+e.productSpecValues[i].id+"><div data-specId="+e.productSpecValues[i].specId+' class="e_box e_box-000 p_images picture higher" style="padding-bottom: 100%; height: 0px;"><div class="e_image e_image-000 p_image visible"><img src="/'+e.productSpecValues[i].imagePath+'" title="'+detaiJson.specConfs[a].alias+'" alt="'+detaiJson.specConfs[a].alias+'" putphotocls="higher"></div></div></div>'):o+="<div data-specId="+e.productSpecValues[i].specId+' class="e_box e_ProductBox-001 p_Product size '+d+'" data-id='+e.productSpecValues[i].id+"><div data-specId="+e.productSpecValues[i].specId+' class="e_box e_box-000 d_articles p_articles"><div class="e_box e_box-000 d_LabelBoxA"><div class="e_title e_info-001 d_label"><div class="font"><i class="iconfont"></i>'+detaiJson.specConfs[a].alias+"</div></div></div></div></div>";break}o+="</div>"}),a.find(".p_products").html(o)),detaiJson&&(PruductskuDetailClick(a,n,detaiJson),sizeDetailClick(a,n,detaiJson)),getPruduct(a,"",n),a.find(".productsA .product").each(function(t,e){for(var i=0;i<detaiJson.skus[0].productSkuSpecs.length;i++)e.getAttribute("data-id")==detaiJson.skus[0].productSkuSpecs[i].specValueId&&a.find("[data-id="+e.getAttribute("data-id")+"]").click()}),e&&0<e.length&&"true"!=n.product&&disabledBtn(".p_Buy .btn,.p_AddCart .btn",a)}function getPruduct(t,e,i){var a=[];t.find(".text").hide(),t.find(".p_products .active").each(function(t,e){a.push(e.getAttribute("data-id"))});var s=0;if(detaiJson&&detaiJson.skus)for(var n=0;n<detaiJson.skus.length;n++){if(s==a.length){"1"==detaiJson.skus[n].isDefault&&(i.skuId=detaiJson.skus[n].id);break}for(var o=s=0;o<detaiJson.skus[n].productSkuSpecs.length;o++){for(var d=0;d<a.length;d++)if(a[d]==detaiJson.skus[n].productSkuSpecs[o].specValueId){s++;break}if(s==a.length){t.find(".d_SalePrice").html('<i class="iconfont"></i>'+Number(detaiJson.skus[n].retailPrice).toFixed(2)),t.find(".d_MarketPrice .font").html('<i class="iconfont"></i>'+Number(detaiJson.skus[n].price).toFixed(2)),t.find(".d_numA").text(detaiJson.skus[n].stock?detaiJson.skus[n].stock:0),t.find(".d_moq").text(detaiJson.skus[n].moq),t.find("#buyNum").val(detaiJson.skus[n].moq||1),moqNum=detaiJson.skus[n].moq,stockNum=detaiJson.skus[n].stock?detaiJson.skus[n].stock:0,tipMoqNum=i.moq=detaiJson.skus[n].moq||1,tipStockNum=i.stock=detaiJson.skus[n].stock?detaiJson.skus[n].stock:1,i.skuId=detaiJson.skus[n].id,detaiJson.skus[n].stock<=0?disabledBtn(".p_Buy .btn",t):removeDisabled(".p_Buy .btn",t),!detaiJson.skus[n].stock||detaiJson.skus[n].stock<detaiJson.skus[n].moq?disabledBtn(".p_AddCart .btn",t):removeDisabled(".p_Buy .btn,.p_AddCart .btn",t);break}}}s!=a.length&&(e.removeClass("active"),t.find(".text").show())}function mouseFn(t,a){t.find(".p_AddCart").mouseenter(function(){var t=$(this).find(".btn").hasClass("disabled"),e=a.errtips.noStock,i=a.errtips.smallStock1+tipMoqNum+a.errtips.smallStock2;t&&($(this).find(".p_tipsBox").removeClass("hide"),tipMoqNum==tipStockNum?$(this).find(".p_tipsBox .font").html(e):tipStockNum<tipMoqNum&&$(this).find(".p_tipsBox .font").html(i))}).mouseleave(function(){$(this).find(".p_tipsBox").addClass("hide")})}function PruductskuDetailClick(i,a,t){var s=t.specConfs,n=new Array;i.find(".p_products .product").unbind("click").click(function(){$(this).addClass("active").siblings(".product").removeClass("active"),$(this).addClass("active").siblings(".size").removeClass("active");var e=$(this).attr("data-id");s.forEach(function(t){t.specValueId==e&&(n=t)}),n.productSpecImgList[0]&&(oldSrc=n.productSpecImgList[0].imagePath,i.find(".zoom .p_image.visible img").attr("src",oldSrc));var t=setNewimgJson(i,a,n);a.imageJson=JSON.parse(a.imageJson),a.imageJson.navs=t,a.imageJson=JSON.stringify(a.imageJson),productImageHandle(a),getPruduct(i,$(this),a)})}var skuClick=function(t,e){var i=t.find(".p_ColorSpec"),a=t.find(".p_ImgSpec");i.each(function(){$(this).on("click",function(){$(this).attr("data-id"),$(this).addClass("active").siblings().removeClass("active")})}),a.each(function(){$(this).on("click",function(){$(this).attr("data-id"),$(this).addClass("active").siblings().removeClass("active")})})};function sizeDetailClick(t,e,i){t.find(".p_products .size").unbind("click").click(function(){$(this).addClass("active").siblings(".size").removeClass("active"),$(this).addClass("active").siblings(".product").removeClass("active"),getPruduct(t,$(this),e)})}function setNewimgJson(t,e,a){var s=new Array;return a.productSpecImgList&&0<a.productSpecImgList.length&&a.productSpecImgList.forEach(function(t){var e=t.imagePath&&t.imagePath.split(".").pop()||"jpg",i={srcBigPic:t.imagePath,bigH:600,title:a.alias,imgHref:"javascript:void(0)",smallH:"",smallW:"",path:t.imagePath+"_{i}xa."+e,smallPath:t.imagePath+"_{i}xa."+e,bigW:800,imgHrefType:"_parent"};s.push(i)}),s}function setNewVideoImgJson(t){var e=$compCl.getScope(t.id);if(t.imageJson&&""!=t.imageJson)a="string"==typeof t.imageJson?JSON.parse(t.imageJson):t.imageJson;else var a=JSON.parse('{"navs":[]}');var s=e.find(".videoUrl").map(function(){return $(this).val()}).get().join(",").split(","),n=e.find(".videoTitle").map(function(){return $(this).val()}).get().join(",").split(","),o=e.find(".videoImgSrc").map(function(){return $(this).val()}).get().join(",").split(",");if(s&&n&&o&&0<s.length&&""!=s[0])for(i=0;i<s.length;i++){var d={bigH:"",bigW:"",imgHref:"javascript:void(0)",imgHrefType:"_parent",path:o[i],smallH:"",smallPath:o[i],smallW:"",srcBigPic:o[i],title:n[i],video_path:s[i]};a.navs.splice(0,0,d)}return a}var oldSrc=null;function PruductskuDetailmouse(e,t){e.find(".p_products .p_Product").on("mouseover",function(){oldSrc=e.find(".zoom .p_image.visible img").attr("src");var t=$(this).find(".p_image.visible img").attr("src");e.find(".zoom .p_image.visible img").attr("src",t)}).on("mouseout",function(){e.find(".zoom .p_image.visible img").attr("src",oldSrc),oldSrc=null})}function addBuySum(t,a,s,e){var i=s.productId,n=s.skuId,o=s.errtips,d=$.trim(a.find(".d_SalePrice").text()),r={};"true"==s.product?r=getProInfo(n):(r.skuName=s.proName,r.skuSpec=""),r.skuImg||(r.skuImg=s.productCoverImgUrl);var c={};c[n]={skuId:n,productId:i,appId:s.appId,buyNum:t,buyPrice:d,skuName:r.skuName,skuSpec:r.skuSpec,skuImg:r.skuImg};var u={appId:s.appId,compId:s.id,firstAsk:!1,toCartParams:JSON.stringify(c)};ajxaQueryFun(a,s,"/interactionApi/shoppingCart/addShoppingCart",u,"POST",function p(t){var e=JSON.parse(t.data),i=JSON.parse(e.data);1==i.flag?(updatePageData(a,s.skuId,i),$.message({msg:o.oneTip,type:"success"})):2==i.flag?$.message({msg:o.twoTip,type:"error"}):4==i.flag?($.message({msg:o.fourTip,type:"error"}),disabledBtn(".p_Buy .btn,.p_AddCart .btn",a)):0==i.flag?$.message({msg:o.zeroTip,type:"error"}):-1==i.flag&&$.message({msg:o.downShopTip,type:"error"});setTimeout(function(){window.location.reload()})})}function updatePageData(t,i,a){t.find(".p_shopCartNum .font").text(a.cartNum).show(),t.find(".js_stockNum").html(a.newStock),$.each(detaiJson.skus,function(t,e){e.id!=i||(e.stock=a.newStock)}),t.find("#product-skuDetail").val(JSON.stringify(detaiJson))}function getProInfo(s){var n={skuName:"",skuSpec:"",skuImg:""};return $.each(detaiJson.skus,function(t,e){if(e.id==s){n.skuName=e.name;for(var i=0;i<e.productSkuSpecs.length;i++)if(i==e.productSkuSpecs.length-1?n.skuSpec+=e.productSkuSpecs[i].specName+":"+e.productSkuSpecs[i].specValueName:n.skuSpec+=e.productSkuSpecs[i].specName+":"+e.productSkuSpecs[i].specValueName+" ",""==n.skuImg)for(var a=0;a<detaiJson.specConfs.length;a++)detaiJson.specConfs[a].id==e.productSkuSpecs[i].specConfigId&&0<detaiJson.specConfs[a].productSpecImgList.length&&""==n.skuImg&&(n.skuImg=detaiJson.specConfs[a].productSpecImgList[0].imagePath);return!1}}),n}function disabledBtn(t,e){$(t,e).addClass("disabled"),$(".js_disabled").on("click",function(t){t.preventDefault()})}function removeDisabled(t,e){$(t,e).removeClass("disabled")}function buttonClickFun(c,u,t){parseInt(c.stock)?removeDisabled(".p_Buy .btn,.p_AddCart .btn",u):disabledBtn(".p_Buy .btn,.p_AddCart .btn",u),u.find(".p_Buy").on("click",function(t){if($(this).find(".btn").hasClass("disabled"))return!1;if(tipStockNum<tipMoqNum)$.message({type:"error",msg:c.errtips.smallStock1+tipMoqNum+c.errtips.smallStock2});else{var e=c.aBuyHref,i=c.aBuyTarget||"_self",a="";a=""!=e?"/"==e.substring(0,1)?window.location.origin+e:window.location.origin+"/"+e:window.location.origin+window.location.pathname;var s=u.find("#buyNum").val(),n=$.trim(u.find(".d_SalePrice").eq(0).text()),o=u.find(".p_products .active").attr("data-specId"),d=(o=u.find(".p_products .product .p_images").attr("data-specId"),[]);d[0]={productId:c.skuId,buyNum:s,buyPrice:n,specId:o};var r=a+"?buyInfo="+encodeURIComponent(JSON.stringify(d));linkSkipFun(u,r,i)}}),u.find(".p_AddCart").on("click",function(){u.find(".p_AddCart .btn").hasClass("disabled")||addBuySum(u.find("#buyNum").val(),u,c,t)}),joinFn(u.find(".p_addInquiry"),$(".js-protalResProductEnquiry_floating_compId").val()),joinFn(u.find(".p_btnB"),$(".js-protalResProduct_floating_compId").val())}function joinFn(t,i){t.unbind("click").click(function(){var t=i,e=$("#"+t);"none"==e.css("display")&&e.show(),productFloat(t,this)})}function productFloat(t,e){if(!isEmpty(t)){var i=$(e).parent(".p_interaction").find(".js_compareFloatData"),a={image:i.attr("image"),name:i.attr("name"),id:i.attr("id"),templateId:i.attr("templateId")};$compCl.getAllInitFunc()[t].add(a)}}var textHandle=function(t,e){e.isCutOfName&&$(".d_title",t).fixLineN(e.linesOfCutOfName),e.isCutOfSummary&&$(".d_summary",t).fixLineN(e.linesOfCutOfSummary),e.productSummary&&$(".d_description",t).fixLineN(e.productSummaryMaxLen)},toBl=function(t,e){t.find(".d_SalePrice .font,.d_MarketPrice .font").each(function(){var t=Number($(this).text()).toFixed(2);$(this).text(t)})};function getViewCount(i,t){if(i.find(".p_ViewBox").length<=0)return!1;var e=parseInt(i.find(".p_ViewBox").attr("data-infoid")),a=2;123==parseInt(t.appId)&&(a=49),124==parseInt(t.appId)&&(a=50);var s={id:e,appTag:a||2};$.ajax({type:"GET",url:"/commentViewCount/ajax/updateAndGetViewCount",data:s,async:!1,success:function(t){var e=JSON.parse(t);e&&200==e.status&&i.find(".p_view .font").html(e.data)}})}function shopCartOption(a,t,e){if(e.firstAsk){var i={appId:t.appId,toCartParams:{},firstAsk:e.firstAsk};ajxaQueryFun(a,t,"/interactionApi/shoppingCart/addShoppingCart",i,"POST",function(t){var e=JSON.parse(t.data),i=JSON.parse(e.data);"3"==i.flag&&a.find(".p_shopCartNum .font").text(i.cartNum).show()})}}var init=function(n){n=this._params;var a=$compCl.getScope(n.id),t=this._params.imageJson;n.productID;buttonClickFun(n,a,t),a.find("img").onErrorImg(),r.lazyImg({defObj:"#"+a.attr("id")}),$.mediaQuery({callback1024:function(){},callback7681024:function(){},callback768:function(){}}),shopCartOption(a,n,{firstAsk:!0}),productImageHandle(n),setTab(n,a),toBl(a,n),mouseFn(a,n),PruductskuDetail(a,n),a.find("#contentPage").click(function(){$(this).addClass("active"),a.find("#paramPage").removeClass("active"),a.find("#contentDiv").removeClass("hide"),a.find("#paramDiv").addClass("hide"),a.find("#moreTextDiv").addClass("hide"),a.find("#commentDiv").addClass("hide"),a.find(".TabHead").removeClass("active"),a.find(".TabCont").addClass("hide"),setPosition()}),a.find("#paramPage").click(function(){$(this).addClass("active"),a.find("#contentPage").removeClass("active"),a.find("#paramDiv").removeClass("hide"),a.find("#contentDiv").addClass("hide"),a.find("#moreTextDiv").addClass("hide"),a.find("#commentDiv").addClass("hide"),a.find(".TabHead").removeClass("active"),a.find(".TabCont").addClass("hide"),setPosition()}),a.find(".TabHead").each(function(t,e){$(e).on("click",function(){$(this).addClass("active").siblings(".TabHead").removeClass("active"),a.find(".TabCont").eq(t).removeClass("hide").siblings(".TabCont").addClass("hide"),a.find("#paramPage").removeClass("active"),a.find("#contentPage").removeClass("active"),a.find("#paramDiv").addClass("hide"),a.find("#contentDiv").addClass("hide"),setPosition()})}),a.find("#moreTextPage").click(function(){a.find("#moreTextDiv").removeClass("hide"),a.find("#contentDiv").addClass("hide"),a.find("#paramDiv").addClass("hide"),a.find("#commentDiv").addClass("hide")}),a.find("#commentPage").click(function(){a.find("#commentDiv").removeClass("hide"),a.find("#contentDiv").addClass("hide"),a.find("#paramDiv").addClass("hide"),a.find("#moreTextDiv").addClass("hide")}),a.find(".p_dcy").click(function(){var t=$(this).data("url");if(""!=t){var e=t.match(/(http|https):\/\//);window.location=e?t:$.getProtocol()+t}}),a.find(".d_plus").on("click",function(){var t=a.find(".d_input").val()||0;parseInt(t)<parseInt(n.stock)&&t++,a.find(".d_input").val(t)}),a.find(".d_minus").on("click",function(){var t=a.find(".d_input").val();parseInt(t)>n.moq&&t--,a.find(".d_input").val(t)}),a.find(".d_input").on("input",function(){/^[0-9]*$/.test(a.find("#buyNum").val())||($.message({msg:n.numberErrorTip,type:"error"}),a.find("#buyNum").val(moqNum||"0")),(parseInt(a.find("#buyNum").val())>parseInt(stockNum||n.stock)||parseInt(a.find("#buyNum").val())<moqNum)&&($.message({msg:n.numberErrorTip,type:"error"}),a.find("#buyNum").val(moqNum||"0"))});var e=n.pMode,s=n.rpType,o=n.ptype;"1"==s&&"1"==o&&("true"==e?a.find(".js_price").remove():a.find(".js_price").addClass("item_hide"));var d=n.numType;"1"==s&&"1"==o&&"true"==d&&("true"==e?a.find(".js_num").remove():a.find(".js_num").addClass("item_hide"));var c=n.attrOneSize,u=n.attrOneStatus;"0"==c||"false"==u?"true"==e?a.find(".js_attrOne").remove():a.find(".js_attrOne").addClass("item_hide"):a.find("#contentPage").removeClass("item_hide");n.attrMoreSize,n.attrMoreStatus,n.pContentSize,n.pContentStatus;if(a.find(".d_DecTab").hasClass("item_hide")&&(a.find(".p_SpecBoxContA").removeClass("hide"),a.find(".d_SpecTab").addClass("active")),a.find(".p_ShareBox,.p_CommentBox,.p_FavoriteBox").each(function(){var t=$.grep($(this).attr("class").split(" "),function(t,e){return t&&-1!=t.indexOf("p_")})[0].split("p_")[1],e={appId:n.appId,id:n.productID},i=0;"ShareBox"==t?e.f=n.shareRule:"CommentBox"==t?(e.f=n.commentARule,i=function a(t,e){var i={format:0,data:0};return $.ajax({type:"POST",url:t,data:e,async:!1,success:function(t){i=$.parseJSON(t)}}),i.format?i.format:0}("/message/ajax/num.do",e)):"FavoriteBox"==t&&(e.f=n.favoriteRule),$(this).find("div:last-child .font").html("<i class='iconfont'></i>"+i)}),n.c_qrcode){a.find(".p_SaveText").css("display","block");var p=commonShortUrl+n.c_qrcode,l=n.qrcodeWidth||255,m=n.qrcodeHeight||255;a.find(".js_qrcode").qrcode({width:l,height:m,render:"canvas",text:p});var f=n.qrbuyUrl,_=n.qrbuyUrlWidth,g=n.qrbuyUrlHeight;a.find(".js_qrbuyUrl").qrcode({width:_,height:g,render:"canvas",text:f})}else a.find(".p_SaveText").css("display","none");var v=JSON.parse(n.img360Arr||"[]"),h=v.map(function(t){return t.url.substring(17,39)}),b=h.length,k=v[0]&&v[0].wide,y=v[0]&&v[0].height;function C(t,e,i,a){var s=e,n=s.substring(s.lastIndexOf(".")+1),o;if(n==="doc"||n==="pdf"||n==="PDF"||n==="mp4"||n==="MP4"||n==="png"||n==="jpg"||n==="jpeg"||n==="gif"||n==="txt"||n==="xml"){window.open(s,"_blank")}else{if(S()||n==="html"){I(s)}else{var d=document.createElement("iframe");d.style.display="none";document.body.appendChild(d);d.src=s}}}function S(){if(!!window.ActiveXObject||"ActiveXObject"in window){return true}else{return false}}function I(t,e,i){var a=window,s="application/octet-stream",n=i||s,o=t,d=!e&&!i&&o,r=document.createElement("a"),c=function(t){return String(t)},u=a.Blob||a.MozBlob||a.WebKitBlob||c,p=e||"download",l,m;u=u.call?u.bind(a):Blob;if(String(this)==="true"){o=[o,n];n=o[0];o=o[1]}if(d&&d.length<2048){p=d.split("/").pop().split("?")[0];r.href=d;var f=decodeURIComponent(r.href);if(f&&f.indexOf(d)!==-1){var _=new XMLHttpRequest;_.open("GET",d,true);_.responseType="blob";_.onload=function(t){I(t.target.response,p,s)};setTimeout(function(){_.send()},0);return _}}if(/^data\:[\w+\-]+\/[\w+\-]+[,;]/.test(o)){if(o.length>1024*1024*1.999&&u!==c){o=g(o);n=o.type||s}else{return navigator.msSaveBlob?navigator.msSaveBlob(g(o),p):v(o)}}l=o instanceof u?o:new u([o],{type:n});function g(t){var e=t.split(/[:;,]/),i=e[1],a=e[2]=="base64"?atob:decodeURIComponent,s=a(e.pop()),n=s.length,o=0,d=new Uint8Array(n);for(o;o<n;++o)d[o]=s.charCodeAt(o);return new u([d],{type:i})}function v(t,e){if("download"in r){r.href=t;r.setAttribute("download",p);r.className="download-js-link";r.innerHTML="downloading...";r.style.display="none";document.body.appendChild(r);setTimeout(function(){r.click();document.body.removeChild(r);if(e===true){setTimeout(function(){a.URL.revokeObjectURL(r.href)},250)}},66);return true}if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent)){t=t.replace(/^data:([\w\/\-\+]+)/,s);if(!window.open(t)){if(confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")){location.href=t}}return true}var i=document.createElement("iframe");document.body.appendChild(i);if(!e){t="data:"+t.replace(/^data:([\w\/\-\+]+)/,s)}i.src=t;setTimeout(function(){document.body.removeChild(i)},333)}if(navigator.msSaveBlob){return navigator.msSaveBlob(l,p)}if(a.URL){v(a.URL.createObjectURL(l),true)}else{if(typeof l==="string"||l.constructor===c){try{return v("data:"+n+";base64,"+a.btoa(l))}catch(h){return v("data:"+n+","+encodeURIComponent(l))}}m=new FileReader;m.onload=function(t){v(this.result)};m.readAsDataURL(l)}return true}0<$(".p_show360").length&&(!function x(){new keyshotVR("KeyShotVR","repository/image",k,y,"#FFFFFF",b,1,!0,!1,-.066667,1,b-1,0,1,1,.96,!0,!1,!1,"jpg",!0,"ks_logo.png",!0,h)}(),ShotVRBtn(a)),textHandle(a,n.textParams),skuClick(a,n),a.find(".d_downloadBox").each(function(t,e){var i=JSON.parse("["+a.find(".ProdownloadId").eq(t).attr("value")+"]");$(this).html(function s(t,e){for(var i="",a=0;a<e.length;a++)i+="<li id="+e[a].id+" data-sign="+e[a].sign+'><i class="iconfont"><span>'+e[a].fileName+"</span></i></li>";return i}(0,i))}),a.find(".itembox").on("click","li",function(){!function o(t,e,a,s){var i={};e==undefined||""==e?i.id=t:(i.id=t,i.sign=e);ajxaQueryFun(a,s,"/repositoryApi/file/findFilesUrl",{formData:JSON.stringify(i)},"POST",function n(t){try{var e=JSON.parse(t.data).data;e&&("/"==e.toLowerCase().slice(0,1)?$.fileDownload(window.location.origin+e):navigator.platform.indexOf("Win")&&"MacIntel"!=navigator.platform?window.location.href=e:C(0,e,a,s))}catch(i){}})}($(this).attr("id"),$(this).attr("data-sign"),a,n)}),getViewCount(a,n),r.lazyImg(),$(function(){setTimeout(function(){var t;if(n.imageJson&&""!=n.imageJson)for(t="string"==typeof n.imageJson?JSON.parse(n.imageJson):n.imageJson,i=0;i<t.navs.length;i++){var a=t.navs[i].title,s=t.navs[i].srcBigPic;$("#c_"+n.id+" .p_images .zoom").each(function(){var t=$(this).find(".p_image").find("img"),e=t.attr("title");a==e&&("/"==s.substr(0,1)?t.attr("src",s):t.attr("src","/"+s))})}},1e3),$("#c_"+n.id+" .j-nav").click(function(){var t=$(this).index(),e=$("#c_"+n.id+" .p_images .zoom").eq(t).attr("imghref");"/"==e.substr(0,1)?$("#c_"+n.id+" .p_images .zoom").eq(t).find("img").attr("src",e):$("#c_"+n.id+" .p_images .zoom").eq(t).find("img").attr("src","/"+e)})})};return{init:init}});