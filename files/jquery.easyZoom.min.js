!function(_){_.fn.easyZoom=function(u){var g,f,d,e,o,i,n,w,v,r=!1,h=!0,z=!1;u=_.extend({id:"easy_zoom",zoomId:"",parent:"body",append:!0,preload:"Loading...",error:"There has been a problem with loading the image."},u);function a(t){z=!0,_(f).css({position:"absolute",top:"0",left:"0"}),_("#"+u.id).html("").append(f),e=_("img",g).width(),i=_("img",g).height(),o=_("#"+u.id).width(),n=_("#"+u.id).height(),w3=_(f).width(),h3=_(f).height(),w4=_(f).width()-o,h4=_(f).height()-n,w4/e,h4/i,s(t)}function p(t){z=!1,_("#"+u.id).remove(),_(t.target).parent().find(".p_zoom").addClass("item_hide")}function s(t){if(z){var e=_(_(g).closest(".picture")),o=_("img",g),i=_(t.target).find(".p_zoom");i.length<=0&&(i=_(t.target).parent().find(".p_zoom"));var n,d=Math.min(e.width(),o.width()),r=Math.max(e.position().left,o.position().left),h=Math.max(e.offset().left,o.offset().left);n=t.clientX<i.outerWidth()/2+h?r:t.clientX>d+h-i.outerWidth()/2?d+r-i.outerWidth():t.clientX-e.offset().left-i.outerWidth()/2,i.css({left:n});var a,s=Math.min(e.outerHeight(),o.outerHeight()),f=Math.max(e.position().top,o.position().top),p=Math.max(e.offset().top,o.offset().top);a=t.clientY+_(document).scrollTop()<i.outerHeight()/2+p?f:t.clientY+_(document).scrollTop()>s+p-i.outerHeight()/2?s+f-i.outerHeight():t.clientY-e.offset().top-i.outerHeight()/2+_(document).scrollTop(),i.css({top:a});var c=o.offset(),l=(i.offset().left-c.left)/o.outerWidth()*w,m=(i.offset().top-c.top)/o.outerHeight()*v;_("#"+u.id+" img").css({left:-l,top:-m})}}this.each(function(){if("a"==(g=this).tagName.toLowerCase()){f=new Image;var t=_(this).attr("imghref");"/"==t.substr(0,1)||/^http/.test(t)?f.src=t:f.src=getImgRepositoryHost()+"/"+t,_(f).error(function(){h=!1}),f.onload=function(){r=!0,f.onload=function(){}},0!=_(g).find("img").length&&_(this).css("cursor","move").mouseover(function(t){!function n(t){p(t),_(t.target).parent().find(".p_zoom").removeClass("item_hide");var e=_('<div id="'+u.id+'">'+u.preload+"</div>");u.append?e.appendTo(u.parent):e.prependTo(u.parent);!function s(t){var e,o=_(t.target),i=function a(t){var e,o,t=t||window.event,i=document.documentElement.scrollLeft||document.body.scrollLeft,n=document.documentElement.scrollTop||document.body.scrollTop,d=t.pageX||t.clientX+i,r=t.pageY||t.clientY+n,h=_(t.target);o=0<h.find("img").length?(e=h.width()-70,h.height()-75):(e=h.parent().width()-70,h.parent().height()-75);e<=(d=d<=75?75:d)&&(d=e);(r=r<=75?75:r)>=o&&(r=o);return{x:d,y:r}}(t),n=_('<div class="e_box e_box-003 p_zoom"></div>');n.css({top:i.x-90,left:i.y-90}),e=0<o.find("img").length?o:o.parent();var d=_(f);{if(_("body").append(d),d.hide(),w=d.get(0).naturalWidth,v=d.get(0).naturalHeight,d.remove(),d.show(),_("#"+u.id).width()*_("#"+u.id).height()/(w*v)<.25){var r=_("#"+u.id).width()/w*_("img",g).width(),h=_("#"+u.id).height()/v*_("img",g).height();return 0===e.find(".p_zoom").length?(e.append(n),n.css({width:r,height:h})):e.find(".p_zoom").css({width:r,height:h}),!0}return p(t),!1}}(t)?p(t):(h?r?a(t):function o(t){r?(a(t),clearTimeout(d)):d=setTimeout(function(){o(t)},200)}(t):function i(){_("#"+u.id).html(u.error)}(),e.css({top:_(u.zoomId).children().offset().top,left:_(u.zoomId).width()+_(u.zoomId).offset().left}))}(t)}).mouseout(function(t){p(t)}).mousemove(function(t){s(t)})}})}}(jQuery);