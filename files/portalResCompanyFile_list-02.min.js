$define(["wgt_util","wgt_readyload","jquery.fileDownload","jquery.mediaQuery","md5","jquery.message","pdf"],function($,$1,r,$2,$3,$4,$5,$6){function paginations(a,n){n.params.url;$(".li_list",a).resPaging(n.params)}function pagination(a,n){var e={firstRefresh:!1};e.url=n.params.url,e.data=n.params,e.successFun=function(a){},$(".p_fileListMo",a).resPaging(e)}var onNewsErrorImghandle=function(a,n,e){1==n||"true"==n?$(".js_thumb",a).onErrorImg(e):$(".js_thumb",a).onErrorImg()},imageHandle=function(a,n){var e=n.defaultImage,i=n.definedDefaultImage;onNewsErrorImghandle(a,i,e);var o=2;if(n.isOpenCutMode&&(o=1),n.isRate){var t=n.widthOfRate/n.heightOfRate;$(".p_img",a).putPhotoDiv(o,t)}else $(".p_img",a).putPhotoDiv(o)},textHandle=function(a,n){n.isCutOfSummary&&$(".isCutOfSummary",a).fixLineN(n.linesOfCutOfSummary),n.categorySummary&&$(".categorySummary",a).fixLineN(n.categorySummaryMaxLen)};function downloadFile(e,i,o,t,r,d,p){e<i.length&&$.fileDownload("/comp/xcompanyFile/download.do?fid="+i[e]+"&appId="+t+"&id="+r,{successCallback:function(a){o=0,e+1<i.length&&downloadFile(e+1,i,o,t,r,d,p),updateCount(d,r,p.params.downloadNumFormat)},failCallback:function(a,n){o+=1,e<i.length&&o<5&&setTimeout(function(){downloadFile(e,i,o,t,r,d,p)},1e3)}})}function getDownloadCount(scope,commentFormat,idsPerPage){$.ajax({url:"/comp/portalResCompanyFile/downloadCount",type:"POST",data:{ids:idsPerPage,f:commentFormat},dataType:"text",success:function(result){if("error"==result||""==result);else for(var data=eval("("+result+")"),i=0;i<data.length;i++){var id=data[i].id,format=data[i].count;scope.find(".p_download[cfileId="+id+"] .font").html('<i class="iconfont"></i><span>'+format+"</span>")}}})}function updateCount(n,e,a){""!=e&&e!=undefined&&$.ajax({type:"post",url:"/comp/xcompanyFile/handleDownload",data:{id:e,f:a},dataType:"html",success:function(a){"failed"!=a&&n.find(".p_download[cfileId="+e+"] .font").find("span").text(a)}})}var ajaxFunc=function(n,e,a,i,o,t,r){var d={};d.request_url=a,d.url_param=i,d.requst_type=o||"GET";var p=encodeURIComponent(encodeURIComponent(JSON.stringify(d))),s=$.md5Sign(JSON.stringify(d));$.ajax({type:"POST",url:"/comp/portalRouter",async:r||r===undefined,data:{param:p,sign:s},success:function(a){t(a,n,e)},error:function(){}})},updateDownNum=function(a,n,e){ajaxFunc(a,n,"/contentApi/files/updateDownload",{id:e},"GET",function i(a){})},init=function(){params=this._params;var e=$compCl.getScope(params.id),d=params.picParams.appId;function a(){$(".p_OccupyBox .p_pagebox").hide(),0<$(".p_OccupyBox .p_page").length&&$(".p_OccupyBox .p_page").css("display","inline-block"),"turnPage"==params.params.turnPageType&&$(".li_list",e).removeAttr("isServerPaging"),paginations(e,params)}imageHandle(e,params.picParams),textHandle(e,params.textParams),768==$.mediaQuery({node:!0})?pagination(e,params):7681024!=$.mediaQuery({node:!0})&&1024!=$.mediaQuery({node:!0})||paginations(e,params),$.mediaQuery({callback1024:function(){a()},callback7681024:function(){a()},callback768:function(){!function a(){$(".p_OccupyBox .p_page").hide(),0<$(".p_OccupyBox .p_pagebox").length?$(".p_OccupyBox .p_pagebox").show():("turnPage"==params.params.turnPageType&&$(".p_fileListMo",e).removeAttr("isServerPaging"),pagination(e,params))}(),e.find(".p_downBtnMo").off("click"),e.find(".p_downBtnMo").on("click",function(){var a=$(this).attr("id"),n=$(this).attr("fileid");if(""!=n&&n!=undefined)for(var e=n.split(","),i=0,o=e.length;i<o;i++){var t=document.createElement("iframe");t.src="/comp/xcompanyFile/download.do?fid="+e[i]+"&appId="+d+"&cId="+a,t.style.display="none",document.body.appendChild(t)}else $.message({msg:"此文件不包含数据",type:"error"})})},keep:!1}),params.DownloadBox&&getDownloadCount(e,params.downloadNumFormat),e.find(".p_downBtn").click(function(){var a=$(this).attr("id"),n=$(this).attr("fileid");""!=n&&n!=undefined&&downloadFile(0,n.split(","),0,params.params.appId,a,e,params)}),$("#c_"+params.id).off("click",".js_view"),$("#c_"+params.id).on("click",".js_view",function(){var a=$(this).siblings(".file-url").val();window.open("https://su.bcebos.com/public/html/pdfjs/viewer/viewernew.html?file="+a,"PDF")}),e.find(".js-dropdown").click(function(a){a.stopPropagation(),$(this).parents(".p_fileItem").siblings().find(".dropdown-menu").css("display","none"),$(this).siblings(".dropdown-menu").toggle()}),$(document).click(function(){e.find(".dropdown-menu").hide()}),r.lazyImg()};return{init:init}});