$define(["wgt_util","wgt_readyload","jquery.adFocus","jquery.mediaQuery","md5","jquery.confirm","jquery.message","jquery.fileDownload"],function(e,f,o,t,r,a,n,s,i){var g=function(e,t,r,a,n,o){var s={};s.request_url=r,s.url_param=a,s.requst_type=n,"true"==t.isMock&&(s.url_param.isMock="true");var i=encodeURIComponent(encodeURIComponent(JSON.stringify(s))),u=f.md5Sign(JSON.stringify(s));f.ajax({type:"POST",url:"/comp/portalRouter",data:{sign:u,param:i},async:!1,success:function(e){o(e)},error:function(){}})},u=function(e,t){var r,a,n,o=t.defaultImage,s=t.definedDefaultImage;r=e,n=o,1==(a=s)||"true"==a?f(".p_images img",r).onErrorImg(n):f(".p_images img",r).onErrorImg();var i=2;if(t.isOpenCutMode&&(i=1),t.isRate){var u=t.widthOfRate/t.heightOfRate;f(".p_image",e).putPhotoDiv(i,u)}else f(".p_image",e).putPhotoDiv(i)};function c(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),r=window.location.search.substr(1).match(t);return null!=r?unescape(r[2]):null}function p(e,t){var r;return f.ajax({type:"POST",url:e,data:t,async:!1,success:function(e){r=e}}),r}function m(e){return"/comp/portalResProduct/list.do?compId="+e}function d(e,r){setTimeout(function(){!function t(e,a){e.find(".p_imagesPc").each(function(e){var t=jQuery.extend(!0,{},a),r=f(this).attr("imgData");f(this).removeAttr("imgData"),r&&(t.data=JSON.parse(r),f(this).adFocus(t),f(this).find("img").attr("src")||f(this).find("img").attr("src","/public/img/no-img.svg")),f(this).find(".p_linkB").attr("href",f(this).data("url")),f(this).find(".p_linkB").attr("target",f(this).data("target"))})}(r,e.imageOpts)},200)}function l(e,t){if(!function n(e){return e==undefined||null==e||0==e.length}(e)){var r=f(t).parent(".p_interaction").find(".js_compareFloatData"),a={image:r.attr("image"),name:r.attr("name"),id:r.attr("id"),templateId:r.attr("templateId")};$compCl.getAllInitFunc()[e].add(a),o.lazyImg()}}function y(n){var o={skuName:"",skuSpec:"",skuImg:"",skuId:""};return o.specId=undefined,o.minBuyNum=1,f.each(n.skus,function(e,t){if(t.productSkuSpecs&&(o.specId="2",o.minBuyNum=t.moq||1),"1"==t.isDefault){o.skuId=t.id,o.skuName=t.name;for(var r=0;r<t.productSkuSpecs.length;r++)if(r==t.productSkuSpecs.length-1?o.skuSpec+=t.productSkuSpecs[r].specName+":"+t.productSkuSpecs[r].specValueName:o.skuSpec+=t.productSkuSpecs[r].specName+":"+t.productSkuSpecs[r].specValueName+" ",""==o.skuImg)for(var a=0;a<n.specConfs.length;a++)n.specConfs[a].id==t.productSkuSpecs[r].specConfigId&&n.specConfs[a].productSpecImgList&&0<n.specConfs[a].productSpecImgList.length&&""==o.skuImg&&(o.skuImg=n.specConfs[a].productSpecImgList[0].imagePath);return!1}}),o}function P(c,t){t.find(".p_addCart").unbind("click").click(function(){var e=f(this).siblings(".js_compareFloatData");!function l(e,t,r){var a,n=r.attr("id"),o=r.attr("price"),s=JSON.parse(r.attr("skuSpec")),i=e.errtips,u={},c=(u=y(s)).skuId;a=u.minBuyNum?u.minBuyNum:1,u.skuImg||(u.skuImg=r.attr("image"));var d={};d[c]={skuId:c,productId:n,appId:e.appId,buyNum:a,buyPrice:o,skuName:u.skuName,skuSpec:u.skuSpec,skuImg:u.skuImg};var p={appId:e.appId,compId:e.id,firstAsk:!1,toCartParams:JSON.stringify(d)};g(t,e,"/interactionApi/shoppingCart/addShoppingCart",p,"POST",function m(e){var t=JSON.parse(e.data),r=JSON.parse(t.data);1==r.flag?f.message({msg:i.oneTip,type:"success"}):2==r.flag?f.message({msg:i.twoTip,type:"error"}):4==r.flag?f.message({msg:i.fourTip,type:"error"}):0==r.flag?f.message({msg:i.zeroTip,type:"error"}):-1==r.flag&&f.message({msg:i.downShopTip,type:"error"}),setTimeout(function(){window.location.reload()})})}(c,t,e)}),t.find(".mouseBtn").mouseenter(function(){f(this).find(".p_tipsBox").removeClass("hide")}).mouseleave(function(){f(this).find(".p_tipsBox").addClass("hide")}),t.find(".p_purchase").unbind("click").click(function(){var e=c.aBuyHref,t=c.aBuyTarget||"_self",r="";r=""!=e?window.location.origin+"/"+e:window.location.origin+window.location.pathname;var a=f.trim(f(this).siblings(".js_compareFloatData").attr("price")),n=JSON.parse(f(this).siblings(".js_compareFloatData").attr("skuSpec")),o=y(n).skuId,s=y(n).minBuyNum,i=[];i[0]={productId:o,buyNum:s,buyPrice:a,specId:y(n).specId},function u(e,t,r){"_blank"==r?f.openNewWindow(t):f.openHref(t),f._UTL.stopEvent(event)}(0,r+"?buyInfo="+encodeURIComponent(JSON.stringify(i)),t)}),t.find(".p_addInquiry").unbind("click").click(function(){var e=f(".js-protalResProductEnquiry_floating_compId"),r=f(this);e.each(function(){var e=f(this).val(),t=f("#"+e);"none"==t.css("display")&&t.show(),l(e,r)})}),t.find(".p_btnB").unbind("click").click(function(){var e=f(".js-protalResProduct_floating_compId").val(),t=f("#"+e);"none"==t.css("display")&&t.show(),l(e,this)})}function h(e,t,r,a,n){var o={id:r,fids:e,appId:t};g(a,n,"/contentApi/files/findFilesUrlList",{formData:JSON.stringify(o)},"POST",function s(e){try{var e=JSON.parse(e.data).data;if(0==e.isLogin)window.location.href=location.origin+"/"+e.loginUrl+"?goToUrl="+location.pathname;else if(2==e.isLogin){var t;t=0==window.tenant.foreign||"zh_CN"==window.tenant.language?"对不起，您无权限做此操作！":"Sorry, you do not have permission to do this operation!",f.message({msg:t,type:"error"})}else{var r=e.fileUrlList;r&&r.length&&(navigator.platform.indexOf("Win")?window.location.href=r[0]:function o(e){var t=e[0],r=t.substring(t.lastIndexOf(".")+1);if("doc"===r||"docx"===r||"pdf"===r||"PDF"===r||"mp4"===r||"MP4"===r||"png"===r||"jpg"===r||"jpeg"===r||"gif"===r||"txt"===r||"xml"===r||"xls"===r||"ppt"===r||"xlsx"===r||"pptx"===r||"zip"===r||"tiff"===r||"mvb"===r||"rmvb"===r||"flv"===r||"rar"===r||"exe"===r||"jar"===r||"gif"===r||"tiff"===r||"RAR"===r||"arj"===r)window.open(t,"_blank");else if(function n(){return!!(window.ActiveXObject||"ActiveXObject"in window)}()||"html"===r)!function v(e,t,r){var a,n,o=window,s="application/octet-stream",i=r||s,u=e,c=!t&&!r&&u,d=document.createElement("a"),p=function(e){return String(e)},m=o.Blob||o.MozBlob||o.WebKitBlob||p,l=t||"download";m=m.call?m.bind(o):Blob;"true"===String(this)&&(i=(u=[u,i])[0],u=u[1]);if(c&&c.length<2048){l=c.split("/").pop().split("?")[0],d.href=c;var f=decodeURIComponent(d.href);if(f&&-1!==f.indexOf(c)){var g=new XMLHttpRequest;return g.open("GET",c,!0),g.responseType="blob",g.onload=function(e){v(e.target.response,l,s)},setTimeout(function(){g.send()},0),g}}if(/^data\:[\w+\-]+\/[\w+\-]+[,;]/.test(u)){if(!(2096103.424<u.length&&m!==p))return navigator.msSaveBlob?navigator.msSaveBlob(y(u),l):P(u);u=y(u),i=u.type||s}a=u instanceof m?u:new m([u],{type:i});function y(e){for(var t=e.split(/[:;,]/),r=t[1],a="base64"==t[2]?atob:decodeURIComponent,n=a(t.pop()),o=n.length,s=0,i=new Uint8Array(o);s<o;++s)i[s]=n.charCodeAt(s);return new m([i],{type:r})}function P(e,t){if("download"in d)return d.href=e,d.setAttribute("download",l),d.className="download-js-link",d.innerHTML="downloading...",d.style.display="none",document.body.appendChild(d),setTimeout(function(){d.click(),document.body.removeChild(d),!0===t&&setTimeout(function(){o.URL.revokeObjectURL(d.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return e=e.replace(/^data:([\w\/\-\+]+)/,s),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var r=document.createElement("iframe");document.body.appendChild(r),t||(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,s)),r.src=e,setTimeout(function(){document.body.removeChild(r)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(a,l);if(o.URL)P(o.URL.createObjectURL(a),!0);else{if("string"==typeof a||a.constructor===p)try{return P("data:"+i+";base64,"+o.btoa(a))}catch(h){return P("data:"+i+","+encodeURIComponent(a))}(n=new FileReader).onload=function(e){P(this.result)},n.readAsDataURL(a)}return!0}(t);else{var a=document.createElement("iframe");a.style.display="none",document.body.appendChild(a),a.src=t}}(r))}}catch(a){}})}return{init:function(){var t=this._params,r=$compCl.getScope(t.id);f(".p_priceUnit.iconfont",r).hasClass("js-retailPriceUnit")&&f(".p_priceUnit.iconfont",r).html()||("zh_CN"!==window.tenant.language?f(".p_priceUnit.iconfont",r).html("&#xe736;"):f(".p_priceUnit.iconfont",r).html("&#xe6d7;")),f(".p_priceUnit.iconfont",r).append("<style>."+t.styleId+" .p_priceUnit::before{display:none}</style>"),r.find(".p_sort").createProductSort(function n(c,d){d=$compCl.getScope(c.id);var e=c.requestParam.orderColumn||"def",t=!0;c.requestParam.orderType&&"0"==c.requestParam.orderType&&(t=!1);var r={key:e,downArraw:t},a={click:function(e,t,r,a){if("def"==r.key){t.attr("lang","active");var n=t.siblings();f.resetOtherSort(n,a),c.requestParam.orderColumn=r.key,c.requestParam.orderType="0"}else{f.triggerProductSort(t,r,a);var o=t.data("productCount");c.requestParam.orderColumn=r.key,c.requestParam.orderType=o}var s="";if(c.requestParam.screenFlag=c.requestParam.screenflag||"false",s="true"==c.requestParam.screenFlag?m(c.id)+"&cache=false":m(c.id),768==f.mediaQuery({node:!0})){var i=f(".p_pagebox .click",d).attr("currentpage");c.requestParam.currentPage=i;var u=p(s,c.requestParam);d.html(u)}else 7681024!=f.mediaQuery({node:!0})&&1024!=f.mediaQuery({node:!0})||(i=f(".pageNum.active",d).html(),c.requestParam.currentPage=i,u=p(s,c.requestParam),d.html(u))}};return{item:[{show:!0,type:"sort",key:"def",v:c.sortParams.DEFAULT_SORT.v,title:c.sortParams.DEFAULT_SORT.title,downArraw:!0,action:a},{show:c.sortParams.PUBLISH_TIME.show,type:"sort",key:"PUBLISH_TIME",v:c.sortParams.PUBLISH_TIME.v,title:c.sortParams.PUBLISH_TIME.title,downArraw:!0,action:a},{show:c.sortParams.PRODUCT_NAME.show,type:"sort",key:"PRODUCT_NAME",v:c.sortParams.PRODUCT_NAME.v,title:c.sortParams.PRODUCT_NAME.title,downArraw:!1,action:a},{show:c.sortParams.PVS.show,type:"sort",key:"PVS",v:c.sortParams.PVS.v,title:c.sortParams.PVS.title,downArraw:!0,action:a},{show:c.sortParams.comment.show,type:"sort",key:"comment",v:c.sortParams.comment.v,title:c.sortParams.comment.title,downArraw:!0,action:a},{show:c.sortParams.PRODUCT_CODE.show,type:"sort",key:"PRODUCT_CODE",v:c.sortParams.PRODUCT_CODE.v,title:c.sortParams.PRODUCT_CODE.title,downArraw:!1,action:a}],elements:{def:{style:c.sortParams.DEFAULT_SORT.style,zstyle:"p_default",tstyle:""},PUBLISH_TIME:{style:c.sortParams.PUBLISH_TIME.style,zstyle:"p_TimeSort",tstyle:"i_TimeSort"},PRODUCT_NAME:{style:c.sortParams.PRODUCT_NAME.style,zstyle:"p_NameSort",tstyle:"i_NameSort"},PVS:{style:c.sortParams.PVS.style,zstyle:"p_ViewSort",tstyle:"i_ViewSort"},comment:{style:c.sortParams.comment.style,zstyle:"p_CommentSort",tstyle:"i_CommentSort"},PRODUCT_CODE:{style:c.sortParams.PRODUCT_CODE.style,zstyle:"p_NoSort",tstyle:"i_NoSort"}},defVal:r}}(t,r)).init(),f("div.p_products").addClass("p_productsSet");var e,a;t.requestParam.orderType||(t.requestParam.orderType="0"),t.requestParam.orderColumn||(t.requestParam.orderColumn="def"),r.find(".js-dropdown").click(function(e){e.stopPropagation(),f(this).parents(".p_Product").siblings().find(".dropdown-toggle").siblings(".dropdown-menu").css("display","none"),f(this).siblings(".dropdown-menu").css("display"),f(this).siblings(".dropdown-menu").toggle()}),f(document).click(function(){r.find(".dropdown-menu").hide()}),r.find(".js_down").off("click"),r.find(".js_down").on("click",function(e){e.stopPropagation(),h(f(this).attr("data-fileId"),t.appId,f(this).attr("data-comId"),r,t)}),isFrontEnv()&&f(window).resize(function(){f.mediaQuery({callback1024:function(){},callback7681024:function(){location.reload()},callback768:function(){},firstLoad:!1})}),768==f.mediaQuery({node:!0})?function o(){f(".p_OccupyBox .p_page").hide(),0<f(".p_OccupyBox .p_pagebox").length?f(".p_OccupyBox .p_pagebox").show():("turnPage"==t.pageParam.turnPageType&&f(".p_products",r).removeAttr("isServerPaging"),function s(e,t){var r=t.pageParam.url+"&orderType="+t.requestParam.orderType+"&orderColumn="+t.requestParam.orderColumn+"&"+t.requestParam.appType+"="+t.requestParam.productCateId,a={url:"true"==t.requestParam.screenflag?r+"&cache=false":r};if(t.requestParam.screenflag!=undefined&&t.requestParam.screenItemStr!=undefined&&t.requestParam.screenGroupId!=undefined){a.data=t.requestParam,a.data.screenFlag=t.requestParam.screenflag;var n=f.getUrlId();if(n&&!isNaN(n))a.data.productCateId=n;else{var o=c("productCateId");o&&!isNaN(o)&&(a.data.productCateId=n)}}a.firstRefresh=!1,t.requestParam.screenType!=undefined&&t.requestParam.screenItemStr!=undefined&&(a.data=t.requestParam,a.data.screenType=t.requestParam.screenType,a.data.screenItemStr=t.requestParam.screenItemStr),f(".p_products",e).resPaging(a)}(r,t))}():7681024!=f.mediaQuery({node:!0})&&1024!=f.mediaQuery({node:!0})||function i(){d(t,r),f(".p_OccupyBox .p_pagebox").hide(),0<f(".p_OccupyBox .p_page").length&&f(".p_OccupyBox .p_page").show(),"turnPage"==t.pageParam.turnPageType&&f(".p_products",r).removeAttr("isServerPaging"),function s(e,t){var r=t.pageParam.url+"&orderType="+t.requestParam.orderType+"&orderColumn="+t.requestParam.orderColumn+"&"+t.requestParam.appType+"="+t.requestParam.productCateId,a={url:"true"==t.requestParam.screenflag?r+"&cache=false":r,appId:t.pageParam.appId,successFun:function(e){}};if(t.requestParam.screenflag!=undefined&&t.requestParam.screenItemStr!=undefined&&t.requestParam.screenGroupId!=undefined){a.requestParam=t.requestParam,a.requestParam.screenFlag=t.requestParam.screenflag;var n=f.getUrlId();if(n&&!isNaN(n))a.requestParam.productCateId=n;else{var o=c("productCateId");o&&!isNaN(o)&&(a.requestParam.productCateId=o)}}t.requestParam.screenType!=undefined&&t.requestParam.screenItemStr!=undefined&&(a.requestParam=t.requestParam,a.requestParam.screenType=t.requestParam.screenType,a.requestParam.screenItemStr=t.requestParam.screenItemStr),f(".p_products",e).resPaging(a)}(r,t)}(),u(r,t.picParams),P(t,r),e=r,(a=t.textParams).isCutOfName&&f(".d_title",e).fixLineN(a.linesOfCutOfName),a.isCutOfSummary&&f(".d_summary",e).fixLineN(a.linesOfCutOfSummary),a.categorySummary&&f(".p_categorySummary",e).fixLineN(a.categorySummaryMaxLen)}}});